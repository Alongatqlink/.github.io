<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VIP Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap CSS (只載入一次) -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- Select2 CSS + Select2 Bootstrap4 Theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css">

  <style>
    .form-container {
      max-width: 600px; 
      margin: 50px auto;
      padding: 20px;
    }

    /* 讓 Select2 的 placeholder 顏色、大小更像其他欄位的 placeholder */
    .select2-container--bootstrap4 .select2-selection__placeholder {
      color: #6c757d; /* 與 Bootstrap placeholder 顏色相近 */
      font-style: italic; /* 模仿 placeholder 斜體 */
    }
  </style>
</head>
<body>

<div class="form-container">
  <h1>VIP Registration</h1>
  <form onsubmit="handleSubmit(event)">
    <!-- Dealer Code (Select2) -->
    <div class="form-group">
      <label for="dealerCode">Dealer Code (required)</label>
      <select id="dealerCode" class="form-control" style="width: 100%;">
        <!-- 預設空白，讓 Select2 用 placeholder 顯示 -->
        <option value=""></option>
      </select>
    </div>

    <!-- Model -->
    <div class="form-group">
      <label for="model">Model (e.g. ABC-123)</label>
      <input type="text" class="form-control" id="model" placeholder="e.g. ABC-123">
    </div>

    <!-- Product Serial -->
    <div class="form-group">
      <label for="productSerial">Product Serial (required)</label>
      <input type="text" class="form-control" id="productSerial" placeholder="Enter product serial" required>
    </div>

    <!-- Customer Name -->
    <div class="form-group">
      <label for="consumerName">Customer Name</label>
      <input type="text" class="form-control" id="consumerName" placeholder="Enter your name">
    </div>

    <!-- Phone / WhatsApp Number -->
    <div class="form-group">
      <label for="phoneNumber">Phone / WhatsApp Number</label>
      <input type="text" class="form-control" id="phoneNumber" placeholder="e.g. +234XXXXXXXX">
    </div>

    <!-- Purchase Date -->
    <div class="form-group">
      <label for="purchaseDate">Purchase Date</label>
      <input type="date" class="form-control" id="purchaseDate" placeholder="yyyy/mm/dd">
    </div>

    <!-- State -->
    <div class="form-group">
      <label for="state">State</label>
      <select id="state" class="form-control">
          <option value="">Select State</option>
          <option value="Abia">Abia</option>
          <option value="Adamawa">Adamawa</option>
          <option value="Akwa Ibom">Akwa Ibom</option>
          <option value="Anambra">Anambra</option>
          <option value="Bauchi">Bauchi</option>
          <option value="Bayelsa">Bayelsa</option>
          <option value="Benue">Benue</option>
          <option value="Borno">Borno</option>
          <option value="Cross River">Cross River</option>
          <option value="Delta">Delta</option>
          <option value="Ebonyi">Ebonyi</option>
          <option value="Edo">Edo</option>
          <option value="Ekiti">Ekiti</option>
          <option value="Enugu">Enugu</option>
          <option value="Gombe">Gombe</option>
          <option value="Imo">Imo</option>
          <option value="Jigawa">Jigawa</option>
          <option value="Kaduna">Kaduna</option>
          <option value="Kano">Kano</option>
          <option value="Katsina">Katsina</option>
          <option value="Kebbi">Kebbi</option>
          <option value="Kogi">Kogi</option>
          <option value="Kwara">Kwara</option>
          <option value="Lagos">Lagos</option>
          <option value="Nasarawa">Nasarawa</option>
          <option value="Niger">Niger</option>
          <option value="Ogun">Ogun</option>
          <option value="Ondo">Ondo</option>
          <option value="Osun">Osun</option>
          <option value="Oyo">Oyo</option>
          <option value="Plateau">Plateau</option>
          <option value="Rivers">Rivers</option>
          <option value="Sokoto">Sokoto</option>
          <option value="Taraba">Taraba</option>
          <option value="Yobe">Yobe</option>
          <option value="Zamfara">Zamfara</option>
          <option value="FCT Abuja">FCT Abuja</option>
          <!-- 根據實際需求新增其他州 -->
        </select>
      </div>
    
    <!-- LGA -->
    <div class="form-group">
      <label for="lga">LGA</label>
      <input type="text" class="form-control" id="lga" placeholder="Enter lga">
    </div>

 <button type="submit" class="btn btn-primary">Submit Registration</button>
  </form>
</div>

  <!-- jQuery (務必在 Select2 JS 之前載入) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
  // 定義 10 個假 Dealer Code
  var dealerCodes = [
    "DealerABC",
    "DealerXYZ",
    "Dealer101",
    "Dealer202",
    "Dealer305",
    "Dealer007",
    "Dealer888",
    "Dealer555",
    "Dealer999",
    "Dealer111"
  ];

    // 處理 DOM 載入完成
  $(document).ready(function() {
    // 1. 將 Dealer Code 加入下拉選單
    var $select = $("#dealerCode");
    dealerCodes.forEach(function(code) {
      $select.append(new Option(code, code));
    });

    // 2. 初始化 Select2，指定 placeholder 與 bootstrap4 主題
    $select.select2({
      placeholder: "Select Dealer Code",
      allowClear: true,
      theme: "bootstrap4"
    });
  });

  // 處理表單送出
  function handleSubmit(event) {
    event.preventDefault();
    var selectedDealer = $("#dealerCode").val();
    var productSerial = $("#productSerial").val();
    alert("Dealer: " + selectedDealer + "\nProduct Serial: " + productSerial);
    // 這裡可以進一步把表單資料送到後端
  }
</script>

  <script>
    // 簡單前端驗證：檢查輸入值中是否含有非法字元
    function isInvalidInput(value) {
      // 此範例只允許英數字、空白、及 -_,.() 等常見符號，你可依需求調整
      const pattern = /^[a-zA-Z0-9\s\-\_,.()\/]*$/;
      return !pattern.test(value);
    }

    function handleSubmit(e) {
      e.preventDefault(); // 阻止預設表單送出

      // 取得表單各欄位值
      const dealerCode    = document.getElementById('dealerCode').value.trim();
      const model         = document.getElementById('model').value.trim();
      const productSerial = document.getElementById('productSerial').value.trim();
      const consumerName  = document.getElementById('consumerName').value.trim();
      const phoneNumber   = document.getElementById('phoneNumber').value.trim();
      const purchaseDate  = document.getElementById('purchaseDate').value.trim();
      const city          = document.getElementById('city').value.trim();
      const state         = document.getElementById('state').value.trim();

      // 基本檢查：必填欄位
      if (!dealerCode || !productSerial) {
        document.getElementById('result').innerText = "Dealer Code and Product Serial are required.";
        return;
      }

      // 前端簡單非法字元檢查 (可視需求擴充)
      if (isInvalidInput(dealerCode) || isInvalidInput(productSerial) ||
          isInvalidInput(model) || isInvalidInput(consumerName) ||
          isInvalidInput(phoneNumber) || isInvalidInput(city) || isInvalidInput(state)) {
        document.getElementById('result').innerText = "Invalid characters detected.";
        return;
      }

      // 使用 URLSearchParams 將資料以表單格式送出 (application/x-www-form-urlencoded)
      const formData = new URLSearchParams();
      formData.append('dealerCode', dealerCode);
      formData.append('model', model);
      formData.append('productSerial', productSerial);
      formData.append('consumerName', consumerName);
      formData.append('phoneNumber', phoneNumber);
      formData.append('purchaseDate', purchaseDate);
      formData.append('city', city);
      formData.append('state', state);

      // 呼叫後端 Apps Script Web App (請將 URL 替換為你的部署 exec URL)
      fetch('https://script.google.com/macros/s/AKfycbzECGqAyJ7Gf88Tgw1DpG4C9mW1qFQCq0OtPmmx1RGS-_esSBE8WOmwed3-Fc5kDdPH/exec', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(text => {
        let data;
        try {
          data = JSON.parse(text);
        } catch (err) {
          document.getElementById('result').innerText = "Response parse error.";
          return;
        }
        if (data.result === "success") {
          document.getElementById('result').innerText = "Registration Successful!";
          document.getElementById('result').className = "mt-3 text-success";
        } else {
          document.getElementById('result').innerText = "Failed: " + (data.error || "Unknown error");
          document.getElementById('result').className = "mt-3 text-danger";
        }
      })
      .catch(error => {
        console.error(error);
        document.getElementById('result').innerText = "Request failed. Please try again.";
      });
    }
  </script>
</body>
</html>
